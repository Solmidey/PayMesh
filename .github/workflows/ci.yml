name: CI
on:
  push: { branches: ["**"] }
  pull_request: { branches: ["**"] }
permissions: { contents: read }
jobs:
  typecheck-and-contracts:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true
      - name: Setup Node
        uses: actions/setup-node@v4
        with: { node-version: "20", cache: "pnpm" }
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with: { version: 10.22.0, run_install: true }
      - name: Build TypeScript packages
        run: pnpm -r --if-present --filter "./packages/*" run build
      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1
        with: { version: nightly }
      - name: Build Contracts
        working-directory: packages/contracts
        run: forge build
